# 技术问题与可行性分析

## 1. 上下文与记忆管理
- **挑战**: 如何在不同的 Agent 之间保持连续性（例如：Agent A 完成了一个任务，Agent B 需要知道 A 做了什么）。
- **建议方案**: “项目记忆 (Project Memory)” / “近期更新 (Recent Updates)” 文件。
- **可行性**: **高**。
- **技术实现**:
  - **分层记忆 (Hierarchical Memory)**: 引入一个“管理者 Agent”维护 `project_state.md`，其他 Worker Agent 仅读取或提交更新请求。
  - **事件溯源 (Event Sourcing)**: 采用“追加写入 (Append-only)”模式记录日志，避免并发覆写导致的数据丢失。
- **推荐工具**: LangGraph (状态管理), 简单的 Markdown 文件操作。

## 2. Agent 状态监控
- **挑战**: 在没有人类持续注视的情况下，检测 Agent 何时“卡住”（无限思考循环或重复错误）。
- **建议方案**:
  - **监督者 Agent (Supervisor Agent)**: 一个轻量级模型，用于监控输出流。
  - **启发式规则**: 超时或“无输出”检测。
- **可行性**: **高**。
- **技术实现**:
  - **Sidecar Watchdog**: 独立的后台进程或 Celery Beat 任务，轮询 Agent 的 stdout/stderr。
  - **检测算法**:
    - **循环动作哈希**: 计算最近 N 个步骤的哈希值，检测重复模式。
    - **错误速率**: 如果单位时间内错误数超过阈值，强制暂停。

## 3. 工作流引擎实现
- **挑战**: 平衡 UI 的简洁性与逻辑的灵活性。
- **建议方案**: **Python 定义的工作流**。
  - UI (白板) 仅仅是底层 Python 脚本的可视化器/触发器。
- **可行性**: **高**。
- **技术实现**:
  - **核心引擎**: 使用 **LangGraph** 或 **Prefect** 定义基于代码的工作流。
  - **可视化**: 前端使用 **Vue Flow**。由于可视化任意 Python 代码极难，建议强制要求 Agent 定义遵循特定的类/装饰器结构，以便静态解析生成图表。

## 4. 前后端集成
- **挑战**: “基于 Web”的 UI 需要深度访问本地机器（文件、终端）。
- **可行性**: **高**。
- **关键技术**:
  - **终端流式传输**:
    - **前端**: `xterm.js`。
    - **后端 (Windows)**: 必须使用 **pywinpty** (因为标准 `pty` 库不支持 Windows) + WebSocket。
  - **文件系统访问**: 使用 FastAPI 构建本地服务器 API (`/api/files/read`, `/api/files/write`)。**必须**实施严格的路径验证以防止目录遍历攻击。
  - **IDE 链接**: 使用 `vscode://file/<absolute-path>:<line>` 协议直接唤起 VS Code。

## 5. 多 Agent 协同
- **挑战**: 管理多个 Agent 的并发执行。
- **建议方案**: 可能会依赖后端引擎（如 `CLAUDE.md` 中提到的 Celery/Task Queue）。
- **可行性**: **极高**。
- **技术实现**:
  - **隔离环境**: 使用 **Git Worktrees**。每个 Agent 任务在一个独立的 Worktree 中运行，确保文件系统隔离。
  - **依赖管理**: Node.js 项目需注意 `node_modules` 的处理（推荐 pnpm 或独立安装）；Python 使用 venv。

## 6. 审查与反馈循环

## 6. 审查与反馈循环
- **挑战**: 解析人类对文档的评论，并将其反馈给特定的 Agent 上下文。
- **技术需求**: 需要一种结构化的方式将“评论”与“文件”和“Agent 任务”关联起来。
